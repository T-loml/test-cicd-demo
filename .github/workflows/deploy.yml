name: Deploy # éƒ¨ç½²åç§°

on:
  push:
    branches: [mian]
    paths-ignore:
      - README.md # å¿½ç•¥æ–‡ä»¶
    pull_request:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest # è¿è¡Œç¯å¢ƒ
    steps:
      # ä¸‹è½½æºç ï¼Œæ£€å‡ºä»“åº“å¹¶ä¸‹è½½é‡Œé¢çš„ä»£ç åˆ°runnerä¸­ï¼Œactions/checkout@v2æ˜¯å®˜æ–¹è‡ªå·±çš„è½®å­ï¼Œå¼€ç®±å³ç”¨
      - name: ä¸‹è½½æºä»£ç 
        uses: actions/checkout@v4 # æ£€å‡ºä»£ç 

      # æ‰“åŒ…æ„å»º
      - name: æ‰“åŒ…æ„å»º
        uses: actions/setup-node@master
        with:
          node-version: "20.x" # æŒ‡å®šéœ€è¦çš„nodeç‰ˆæœ¬
      - run: npm install
      - run: npm run build

    # éƒ¨ç½²åˆ°é˜¿é‡Œäº‘OSSï¼ˆæ›¿æ¢COSéƒ¨ç½²ï¼‰
      - name: éƒ¨ç½²åˆ°é˜¿é‡Œäº‘OSS
        uses: manyuanrong/ossutil@v3.0.0
          with:
          publish_branch: gh-pages # éƒ¨ç½²åˆ†æ”¯
          publish_dir: ./dist # éƒ¨ç½²ç›®å½•
          # é˜¿é‡Œäº‘è®¿é—®å‡­è¯
          accessKeyId: ${{ secrets.ALY_SECRET_ID }}
          accessKeySecret: ${{ secrets.ALY_SECRET_KEY }}
          # OSSé…ç½®
          endpoint: ${{ secrets.ALY_ENDPOINT }}
          bucket: ${{ secrets.ALY_BUCKET }}
          clear: true
          
      - name: éƒ¨ç½²æˆåŠŸï¼Œå¯è®¿é—®åŸŸå
        run: |
          echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
          echo "ğŸŒ ç½‘ç«™è®¿é—®åœ°å€ï¼šhttp://${{ secrets.OSS_BUCKET }}.${{ secrets.OSS_ENDPOINT }}"


      # éƒ¨ç½²åˆ°æœåŠ¡å™¨
      # - name: Deploy to server
      #   uses: peaceiris/actions-gh-pages@v3
      #   with:
      #     publish_branch: gh-pages # éƒ¨ç½²åˆ†æ”¯
      #     publish_dir: ./dist # éƒ¨ç½²ç›®å½•
      #     github_token: ${{ secrets.CICD_DEMO }} # ä»¤ç‰Œ
      #     user_name: ${{ secrets.MY_USERNAME }}
      #     user_email: ${{ secrets.MY_EMAIL }}
      #     commit_message: è‡ªåŠ¨éƒ¨ç½²
